{
  "hash": "3d00af03a9e3edac91fcad2ceecf3cc1",
  "result": {
    "markdown": "---\ntitle: Beware of Boundaries in Binominal Proportion Confidence Intervals  \nauthor: Dean Marchiori\ndate: '2023-03-13'\ncategories: [R, analysis]\nimage: \"featured.png\"\n---\n\n\nBinomial proportion confidence intervals are often employed when attempting to \nperform tests for significance, or sample size calculations around sample\nmeasurements resulting from a [Bernoulli process.](https://en.wikipedia.org/wiki/Bernoulli_process)\n\nThe typical choice when calculating binomial proportion confidence intervals is the \nasymptotic, or normally approximated 'Wald' interval where success probability\nis measured by:\n\n$$\n\\hat{p} \\pm z_{\\alpha/2}\\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}\n$$  \n\nIn many settings, such as marketing analytics or manufacturing processes the \nsample proportion is close to 0 or 1. Evaluating asymptotic confidence intervals\nnear these boundary conditions will lead to underestimation of the error, and in some\ncases producing an interval outside $[0, 1]$. \n\nFortunately other methods exist, such as Wilson's score interval, exact methods and Bayesian\napproaches. The recommendation here is to examine the probability coverage and explore alternative\nmethods for sample size and CI calculation, especially when the parameter is\nnear the boundary conditions, or in cases of very small n.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(binom)\nlibrary(tidyverse)\n\nn <- 50\np <- c(0.01, 0.5, 0.99)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- purrr::map_df(p, .f =  ~binom.confint(x = n * .x, n = n, methods = 'all'))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(x, aes(colour = factor(x))) +\n  geom_point(aes(mean, method), show.legend = F) +\n  geom_errorbarh(aes(xmin = lower, xmax = upper, y = method), show.legend = F) +\n  geom_vline(xintercept =  c(0, 1), lty = 2, col = \"grey\") +\n  facet_wrap(~(x*2/100)) +\n  theme_bw() +\n  labs(title = \"A variety of binomial confidence interval methods for p = 0.01, 0.5 & 0.99\",\n       subtitle = \"Note unusual behaviour near 0.01 and 0.99\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncov <- purrr::map_df(p, ~binom.coverage(.x, n, conf.level = 0.95, method = \"all\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(cov, aes(colour = factor(p))) +\n  geom_point(aes(coverage, method), show.legend = F) +\n  geom_vline(xintercept =  0.95, lty = 2) +\n  facet_wrap(~(p)) +\n  theme_bw() +\n  labs(title = \"Probability coverage for a variety of binomial confidence interval methods\",\n       subtitle = \"Reference line at 0.95 coverage\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nA good discussion is contained in:\n\nWallis, Sean A. (2013). \"Binomial confidence intervals and contingency tests: mathematical fundamentals and the evaluation of alternative methods\" (PDF). **Journal of Quantitative Linguistics.** 20 (3): 178â€“208. doi:10.1080/09296174.2013.799918. S2CID 16741749.\n\nhttps://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}